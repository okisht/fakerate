<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <input class="productUrl" type="text">
  <button onclick="applyImg()">apply</button>
  <br>
  <button onclick="postupvote()">upvote</button>
  <button onclick="postdownvote()">downvote</button>

</body>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
  function applyImg() {

    newImgUrl = $('.productUrl').val();
    var spliturl = $('.productUrl').val().split(".");
    var newPdId = spliturl[2].split("/");

    $.ajax({
      'url': 'http://localhost:4000/api/v1',
      'method': 'POST',
      'dataType': 'json',
      processData: false,
      'contentType': 'application/json',
      'data': JSON.stringify({
        imgUrl: newImgUrl,
        upvotes: 0,
        downvotes: 0,
        wtb: "test",
        productid: newPdId[1],
      }),
      'success': function (data) {
        console.log(data)
        window.location.href = "http://localhost:4000/api/v1/"+data.productid;
      }
    });

  }


  function postupvote() {
    /* get id dinamik alÄ±nacak */

    $.get("http://localhost:4000/api/v1/ADtKScW", function (data) {
      var newupvts = parseInt(data.upvotes) + 1;
      var uniqid = data._id;
      var uniqidurl = "http://localhost:4000/api/v1/" + uniqid;
      upvoteUpdate(uniqidurl, newupvts);
    });

    function upvoteUpdate(uniqidurll, newupvtss) {
      $.ajax(
        {
          "async": true,
          "crossDomain": true,
          "url": uniqidurll,
          "method": "PUT",
          "headers": {
            "Content-Type": "application/json",
            "cache-control": "no-cache",
            "Postman-Token": "3c73b1e8-dd77-4f03-a2eb-5328fa047d22"
          },
          "processData": false,
          "data": "{\n    \"upvotes\": \"" + newupvtss + "\"\n}"
        }
      ).done(function (response) {
        console.log(response);
      });
    }

  }
</script>

</html>